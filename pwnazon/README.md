Λύση pwnazon

Για αρχή έλεγξα όλα τα source αρχεία του website έτσι ώστε να βρω κάποιο vulnerability.
Πρώτα είδα στο browse.php ότι μπορεί να υπάρχουν ενδεχομένως κάποια items τα οποία να είναι ορατά μόνο για τον admin. Εν τέλει όμως στο utils.php δεν έχει δημιουργηθεί κάποιο τέτοιο item.
Το επόμενο ενδιαφέρον πράγμα που βρήκα ήταν η κλάση secure_check η οποία έχει δημιουργηθεί αλλά δεν χρησιμοποιείται κάπου. Η συνάρτηση __wakeup της secure_check καλεί την eval για μία συνάρτηση, κάτι
το οποίο μπορεί να προκαλέσει vulnerability.
Επίσης, βάζοντας κάποιο item/items στο καλάθι, παρατηρούμε ότι δημιουργείται ένα cookie 'STATE' και επιπλέον χρησιμοποείται η serialize και unserialize της php οι οποίες δεν είναι ασφαλείς(PHP Object Injection attack).
Επομένως αυτό που μπορούμε να κάνουμε είναι να γράψουμε ένα php script το οποίο θα δημιουργεί την ίδια κλάση secure_check και θα προσπαθεί μέσω του cookie 'STATE' να τρέξει κάποιες εντολές που θα του δώσουμε.
Γνωρίζουμε από το hint ότι υπάρχει ένα αρχείο που ξεκινάει με το όνομα flag_, επομένως θέλουμε να τρέξουμε ιδανικά το 'ls' έτσι ώστε να δούμε το πλήρες όνομα του αρχείου.
Εφόσον δούμε το όνομα, πλέον μπορούμε να κάνουμε 'cat' έτσι ώστε να πάρουμε το flag.
( Επειδή το func της secure_check είναι private, πρέπει να φτιάξουμε ένα reflection της κλάσης έτσι ώστε να μπορούμε να αλλάξουμε την τιμή της func. )
Τέλος, επειδή το script μας δεν διαχειριζόταν σωστά τα spaces στην κλήση μιας system εντολής, πρέπει να δώσουμε το αρχείο στο cat με redirect( δηλαδή, 'cat<flag_*' )
Η λύση που μας δίνει τα δύο values για το cookie βρίσκεται στο αρχείο state_cookie.php

